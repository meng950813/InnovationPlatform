// by zhangxixnu 2010-06-21  welcome to visit my personal website http://www.zhangxinxu.com/
// textSearch.js v1.0 文字，关键字的页面纯客户端搜索
// 2010-06-23 修复多字母检索标签破碎的问题
// 2010-06-29 修复页面注释显示的问题
// 2013-05-07 修复继续搜素关键字包含之前搜索关键字没有结果的问题
// 不论何种情况，务必保留作者署名。
(function($){$.fn.textSearch=function(str,options){var defaults={divFlag:true,divStr:" ",markClass:"",markColor:"#009FE8",nullReport:true,callback:function(){return false}};var sets=$.extend({},defaults,options||{}),clStr;if(sets.markClass){clStr="class='"+sets.markClass+"'"}else{clStr="style='color:"+sets.markColor+";'"}$("span[rel='mark']").each(function(){var text=document.createTextNode($(this).text());$(this).replaceWith($(text))});$.regTrim=function(s){var imp=/[\^\.\\\|\(\)\*\+\-\$\[\]\?]/g;var imp_c={};imp_c["^"]="\\^";imp_c["."]="\\.";imp_c["\\"]="\\\\";imp_c["|"]="\\|";imp_c["("]="\\(";imp_c[")"]="\\)";imp_c["*"]="\\*";imp_c["+"]="\\+";imp_c["-"]="\\-";imp_c["$"]="$";imp_c["["]="\\[";imp_c["]"]="\\]";imp_c["?"]="\\?";s=s.replace(imp,function(o){return imp_c[o]});return s};$(this).each(function(){var t=$(this);str=$.trim(str);if(str===""){console.log("关键字为空");return false}else{var arr=[];if(sets.divFlag){arr=str.split(sets.divStr)}else{arr.push(str)}}var v_html=t.html();v_html=v_html.replace(/<!--(?:.*)\-->/g,"");var tags=/[^<>]+|<(\/?)([A-Za-z]+)([^<>]*)>/g;var a=v_html.match(tags),test=0;$.each(a,function(i,c){if(!/<(?:.|\s)*?>/.test(c)){$.each(arr,function(index,con){if(con===""){return}var reg=new RegExp($.regTrim(con),"g");if(reg.test(c)){c=c.replace(reg,"♂"+con+"♀");test=1}});c=c.replace(/♂/g,"<span rel='mark' "+clStr+">").replace(/♀/g,"</span>");a[i]=c}});var new_html=a.join("");$(this).html(new_html);if(test===0&&sets.nullReport){console.log("没有搜索结果");return false}sets.callback()})}})(jQuery);
